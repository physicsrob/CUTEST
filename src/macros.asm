CALL_UNTIL_NZ	MACRO	ADDR
$$loop		CALL ADDR
		JZ $$loop
		ENDM


ADD_PSEUDOPORT	MACRO	i, \
				VDM, \
				DATAPORT, \
				STATUSPORT, \
				READMASK, \
				READINVERT, \
				WRITEMASK, \
				RESETMASK, \
				SETUPMASK \
		
PSEUDO_i_STATUS_PORT:	EQU STATUSPORT
PSEUDO_i_DATA_PORT:		EQU STATUSPORT

				IF STRLEN("SETUPMASK")>0
PSEUDO_i_STATUS_SETUP_MASK:	EQU SETUPMASK
				ENDIF
				IF STRLEN("RESETMASK")>0
PSEUDO_i_STATUS_RESET_MASK:	EQU RESETMASK
				ENDIF

IN_i:		EQU $
		IN STATUSPORT
		IF STRLEN("READINVERT")>0
		   CMA
		ENDIF
		ANI READMASK
		RZ
		IN DATAPORT
		RET

		IF STRLEN("VDM")>0
OUT_i:		   EQU VDM01
		ELSE
OUT_i:		   EQU $
$$loop		   IN STATUSPORT
		   ANI WRITEMASK
		   JZ $$loop
		   MOV A,B
		   OUT DATAPORT
		   RET
		ENDIF
		ENDM
	