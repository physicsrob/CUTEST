CALL_UNTIL_NZ	MACRO	ADDR
$$loop		CALL ADDR
		JZ $$loop
		ENDM


ADD_PSEUDOPORT	MACRO	i, \
				VDM, \
				DATAPORT, \
				STATUSPORT, \
				READMASK, \
				READINVERT, \
				WRITEMASK, \
				RESETMASK, \
				SETUPMASK \
		

IN_i:		EQU $
		IN STATUSPORT
		IF STRLEN("READINVERT")>0
		   CMA
		ENDIF
		ANI READMASK
		RZ
		IN DATAPORT
		RET

		IF STRLEN("VDM")>0
OUT_i:		   EQU VDM01
USE_VDM:	   EQU TRUE
		ELSE
OUT_i:		   EQU $
$$loop		   IN STATUSPORT
		   ANI WRITEMASK
		   JZ $$loop
		   MOV A,B
		   OUT DATAPORT
		   RET
		ENDIF

SETUP_i	MACRO
		   IF STRLEN("RESETMASK")>0
			MVI	A, RESETMASK 
			OUT	STATUSPORT	
		   ENDIF
		   IF STRLEN("SETUPMASK")>0
			MVI	A, SETUPMASK 
			OUT	STATUSPORT	
		   ENDIF
		ENDM

		ENDM
	

ADD_COMMAND	MACRO i, NAME, PTR, HELP
CMDNAME_i	SET NAME
CMDPTR_i	SET PTR
		ENDM	


GET_COMTAB_ENTRY	MACRO i
			IFDEF CMDNAME_i
			DB	CMDNAME_i
			DW	CMDPTR_i
			ENDIF
			ENDM

